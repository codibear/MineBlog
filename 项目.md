# 占领图书馆这是“占领图书馆”APP的后端### 实现的功能- 用户注册：利用模拟登陆教务系统，实时验证用户是否为本校学生。  - 模拟登陆教务系统用到了我的另一个项目：[tsxyScore](https://github.com/bllli/tsxyScore)- 学习记录，学习记录计时功能- 用户信息查询、用户的学习记录查询功能### 采用技术- Web框架：Python Flask- 数据库ORM：Sqlalchemy- 前后对接：RESTful API规范 + json + HTTP Basic Auth- HTTPS连接，不知道比HTTP安全到哪里去了# RESTful API 文档URL前部分均为:https://domain.cn:port/api/ID|URL| method |备注---|---|---|---1|v1.0/users/<user_id>|GET|通过用户id获取用户信息2|v1.0/studys|GET|获取所有学习记录3|v1.0/studys/|POST|学习开始 注意url最有有个"/"4|v1.0/studys/<study_id>|PUT|结束学习,可以传入结束时间,时间应为utc时间5|v1.0/token|GET|用账号密码换取token6|v1.0/studys/<study_id>|GET|用id获取学习记录7|v1.0/register|POST|注册账号- 所有传出/传入的时间均为utc标准时间, 格式均为yyyy-MM-dd HH:mm:ss(四位年-两位月份-两位日 两位24制小时:两位分钟:两位秒)- 除注册账号外，所有请求请均附加上HTTP BasicAuth### 1.通过用户id获取用户信息#### 请求地址`v1.0/users/<user-id>`#### 接口描述获取用户信息 , 注意`<user-id>`代表需要填写的用户id#### 请求类型HTTP GET#### 请求参数参数名|类型|必填|描述|默认值|参考值---|---|---|---|---|---user-id|数字|Y|用户id|-|1注意, url中的`<user-id>`应替换为此参数的值#### 调用示例`$ http --auth 1@1.com:123 --json GET http://127.0.0.1:5000/api/v1.0/users/1`#### 正确返回json示例```{    "last_seen": "2017-03-25 06:44:35",    "member_since": "2017-03-25 06:41:49",    "studys": "http://127.0.0.1:5000/api/v1.0/users/1/studys/",    "url": "http://127.0.0.1:5000/api/v1.0/users/1",    "username": "bllli"}```#### 请求返回结果参数说明字段名称|字段说明|类型|备注---|---|---|---username|用户名|string|-url|用户页面url|string|-studys|该用户的学习记录列表|string|-member_since|注册时间|string|utc时间, 格式为yyyy-MM-dd HH:mm:sslast_seen|最后登录时间|string|utc时间, 格式为yyyy-MM-dd HH:mm:ss### 2.获取所有学习记录#### 请求地址`v1.0/studys/`#### 请求类型HTTP GET#### 接口描述获取所有学习记录#### 请求参数无#### 正确返回json示例```{    "count": 7,    "next": null,    "prev": null,    "studys": [        {            "creator": "http://127.0.0.1:5000/api/v1.0/users/1",            "end_time": null,            "id": 1,            "start_time": "2017-03-25 07:13:32",            "url": "http://127.0.0.1:5000/api/v1.0/studys/1"        },        {...}        ]}```#### 请求返回结果参数说明字段名称|字段说明|类型|备注---|---|---|---count|学习记录总数|int|-next|下一页学习记录的url|string|-prev|上一页学习记录的url|string|-studys|学习记录数组|json数组|详情见下### 3.学习开始#### 请求地址`v1.0/studys/`#### 接口描述开始学习, 为发送请求的用户创建一条学习记录, 并返回该学习记录的id注意需要在客户端保存学习记录的id, 以便结束该学习记录#### 请求类型HTTP POST#### 请求参数参数名|类型|必填|描述|默认值|参考值---|---|---|---|---|---start_time|string|N|开始时间|现在时间(utc)|"2017-03-25 11:55:47"注意传入的时间必须是utc标准时间, 时间格式为yyyy-MM-dd HH:mm:ss#### 正确返回json示例```{    "creator": "http://127.0.0.1:5000/api/v1.0/users/1",    "end_time": null,    "id": 8,    "start_time": "2017-03-25 11:55:47",    "url": "http://127.0.0.1:5000/api/v1.0/studys/8"}```#### 请求返回结果参数说明字段名称|字段说明|类型|备注---|---|---|---id|学习记录id|int|注意保存, 以便结束学习进程url|本条学习记录的url|string|-creator|学习记录创建者的url|string|-start_time|开始时间|string|-end_time|结束时间|string|-### 4.通过学习记录id结束学习#### 请求地址`v1.0/studys/<study-id>`#### 接口描述结束学习, 为指定的学习记录添加结束时间#### 请求类型HTTP PUT#### 请求参数json参数名|类型|必填|描述|默认值|参考值---|---|---|---|---|---end_time|string|N|结束时间|现在时间|"2017-03-25 11:45:50"注意传入的end_time时间必须为utc标准时间, 留空则默认结束时间为当前时间参数名|类型|必填|描述|默认值|参考值---|---|---|---|---|---study-id|数字|Y|学习记录id|-|1注意, url中的`<study-id>`应替换为此参数的值#### 正确返回json示例```{    "creator": "http://127.0.0.1:5000/api/v1.0/users/1",    "end_time": "2017-03-25 11:45:50",    "id": 7,    "start_time": "2017-03-25 10:57:43",    "url": "http://127.0.0.1:5000/api/v1.0/studys/7"}```#### 请求返回结果参数说明字段名称|字段说明|类型|备注---|---|---|---id|学习记录id|int|注意保存, 以便结束学习进程url|本条学习记录的url|string|-creator|学习记录创建者的url|string|-start_time|开始时间|string|-end_time|结束时间|string|-### 6.通过学习id获取学习记录#### 请求地址`v1.0/studys/<study-id>`#### 接口描述通过学习记录id获取学习记录的具体信息#### 请求类型HTTP GET#### 请求参数参数名|类型|必填|描述|默认值|参考值---|---|---|---|---|---study-id|数字|Y|学习记录id|-|1注意, url中的`<study-id>`应替换为此参数的值#### 正确返回json示例```{    "creator": "http://127.0.0.1:5000/api/v1.0/users/1",    "end_time": "2017-03-25 12:00:02",    "id": 8,    "start_time": "2017-03-25 11:55:47",    "url": "http://127.0.0.1:5000/api/v1.0/studys/8"}```#### 请求返回结果参数说明字段名称|字段说明|类型|备注---|---|---|---id|学习记录id|int|注意保存, 以便结束学习进程url|本条学习记录的url|string|-creator|学习记录创建者的url|string|-start_time|开始时间|string|-end_time|结束时间|string|-### 7.注册账号#### 请求地址`v1.0/register`#### 接口描述注册功能用户自拟账号密码，并需要提供唐山学院教务系统的账号密码。  仅当教务系统的账号密码测试登录成功时， 才会允许用户注册。#### 请求类型HTTP POST#### 请求参数参数名|类型|必填|描述---|---|---|---username|string|Y|用户名password|string|Y|用户密码stu_id|string|Y|学号（）stu_pwd|string|Y|教务系统密码#### 正确返回json操作正确即返回user json，详见[1.通过用户id获取用户信息](https://github.com/bllli/CuptureLibrary#1通过用户id获取用户信息)#### 错误返回json示例```json{  "error": "bad request",  "message": "该学号被注册，可以试试找回密码。"}```#### 请求返回结果参数说明字段名称|字段说明|类型|备注---|---|---|---error|错误类型|string|message|错误信息|string|此处会出现的错误信息如下表所示message|含义---|---该学号被注册，可以试试找回密码。|学号被占用了缺少必要参数。|传入的json缺斤少两用户已经存在。|用户名重复了学号应该是一个十位数或是九位数.|学号不对402, 账号或密码错误|学号或教务系统密码错误#### EOF